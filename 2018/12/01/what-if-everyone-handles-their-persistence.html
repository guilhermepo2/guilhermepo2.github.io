<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="https://gueepo.me//assets/css/syntax.css"><link rel="preconnect" href="https://cdnjs.cloudflare.com"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><title> What if everyone handles their own persistence? - gueepo</title><link rel="shortcut icon" href="https://gueepo.me//favicon.png"><link rel="alternate" type="application/atom+xml" title="gueepo" href="https://gueepo.me//atom.xml"><link rel="alternate" type="application/json" title="gueepo" href="https://gueepo.me//feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="https://gueepo.me//sitemap.xml" /><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,300;1,400;1,500;1,600;1,700;1,900&display=swap" rel="stylesheet"><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}html{font-size:15px}#theme-toggle{opacity:0.65;position:relative;border-radius:5px;height:25px;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;transition:opacity 0.3s ease 0s;border:none;outline:none;background:none;cursor:pointer;padding:0px;appearance:none;transform:scale(0.8)}html,html[data-theme="light"]{--text-font: Play;--source-code-font: Source Code Pro;--very-light-text-color: rgb(222, 222, 222);--light-text-color: rgb(89, 183, 255);--medium-text-color: #555;--main-text-color: #333;--highlight-text-color: #6cb4a0;--dark-text-color: #393e46;--link-color: rgb(50, 87, 209);--code-bg-color: rgb(245, 245, 245);background-color:#fff}html #theme-toggle div,html[data-theme="light"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:none;background-color:var(--theme-ui-colors-transparent, transparent);transform:scale(1);transition:all 0.45s ease 0s;overflow:hidden;box-shadow:inset 8px -8px 0px 0px var(--theme-ui-colors-toggleIcon, #2d3748)}html #theme-toggle div::before,html[data-theme="light"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:none;border-radius:50%;transform:translate(0px, 0px);opacity:1;transition:transform 0.45s ease 0s}html #theme-toggle div::after,html[data-theme="light"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),0 23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),-23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748);transform:scale(0);transition:all 0.35s ease 0s}html[data-theme="dark"]{--text-font: Play;--source-code-font: Source Code Pro;--very-light-text-color: #EEE;--light-text-color: #c4bbf0;--medium-text-color: #52057b;--main-text-color: #EAEAEA;--highlight-text-color: #6cb4a0;--dark-text-color: rgb(36, 38, 42);--link-color: rgb(255, 89, 125);--code-bg-color: rgb(36, 38, 42);background-color:#131418}html[data-theme="dark"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:4px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);background-color:var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(0.55);transition:all 0.45s ease 0s;overflow:visible;box-shadow:none}html[data-theme="dark"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:2px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);border-radius:50%;transform:translate(14px, -14px);opacity:0;transition:transform 0.45s ease 0s}html[data-theme="dark"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),0 23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(1);transition:all 0.35s ease 0s}body{font-family:var(--text-font),monospace;text-rendering:optimizeLegibility;line-height:1.75;color:var(--main-text-color)}a{color:var(--link-color);text-decoration:none}.post p{margin:1rem 0}.meta{margin:1.4rem 0}code,pre{background:var(--code-bg-color);margin:0 -27px;border-width:1px}code{font-family:var(--source-code-font),monospace;margin:unset;padding:0.1rem;color:var(--highlight-text-color)}pre code{background-color:unset;color:unset}pre{border-width:3px;padding:0.8rem;white-space:pre-wrap;border-style:none none none solid;border-color:var(--light-text-color)}img{max-width:100%}hr{background:var(--light-text-color);height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:0.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem 0}section{margin-top:8rem}blockquote{font-style:italic;border-left:5px solid var(--dark-text-color);padding-left:1rem}h1{color:var(--main-text-color);text-transform:uppercase;font-size:2rem;font-weight:bold;margin-bottom:1.5rem}h2,h3,h4,h5{font-weight:bold;margin-bottom:1.5rem;font-size:2rem}h2{font-size:1.8rem}h3{font-size:1.6rem}h4{font-size:1.4rem}h5{font-size:1.2rem}h6{font-size:1rem}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts>h3{font-weight:500}.post ul{margin:0px;margin:0px 0px 10px 10px}.post ol{margin:0px;margin:0px 0px 10px 15px}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:0.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}time{color:var(--main-text-color)}.post>h1.title{font-size:x-large;margin-top:0;margin-bottom:0}.post>time{margin-bottom:0;margin-top:3rem}.highlight{margin:0px}main{display:flex;max-width:47rem;margin:-5rem auto 0;padding-top:2.4rem;padding-bottom:0.0rem;padding-left:2rem;padding-right:2rem;flex-direction:column}.flex-row-between{display:flex;flex-direction:row;justify-content:space-between}.social-footer{padding:1rem;display:flex;justify-content:center;position:initial}.social-footer .social-footer-icons .fa{font-size:1.3rem;color:#a9a9a9}.social-footer .social-footer-icons .fa:hover{color:dimgray;transition:color 0.3s ease-in}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}main{padding:0 2rem}}section{flex-grow:999;display:flex;flex-direction:column}figcaption{font-size:smaller}.bio{margin-bottom:1rem}::selection{background-color:#fffba0;color:#333}.search-article{position:relative}.search-article label[for="search-input"]{position:relative;top:-10px;left:11px}.search-article input[type="search"]{top:-1rem;left:0;border:0;width:100%;height:30px;outline:none;position:absolute;border-radius:5px;padding:10px 10px 10px 35px;color:var(--main-text-color);-webkit-appearance:none;background-color:rgba(128,128,128,0.1);border:1px solid rgba(128,128,128,0.1)}.search-article input[type="search"]::-webkit-input-placeholder{color:#808080}.search-article input[type="search"]::-webkit-search-decoration,.search-article input[type="search"]::-webkit-search-results-decoration{display:none}#search-results{text-align:center}#search-results li{text-align:center}#search-results li::before{content:"›";display:inline-block;margin-left:-1.3em;width:1.3em;color:var(--main-text-color)}.post-nav{display:flex;position:relative;margin-top:0;border-top:2px solid var(--light-text-color);line-height:1.4}.post-nav .post-nav-item{border-bottom:0;padding-bottom:10px;width:50%;padding-top:10px;text-decoration:none;box-sizing:border-box}.post-nav .post-nav-item .post-title{color:var(--main-text-color)}.post-nav .post-nav-item:hover .post-title,.post-nav .post-nav-item:focus .post-title{color:var(--link-color);opacity:0.9}.post-nav .post-nav-item .nav-arrow{font-size:17px;color:var(--main-text-color);margin-bottom:3px;font-weight:bold}.post-nav .post-nav-item:nth-child(odd){padding-left:0;padding-right:20px}.post-nav .post-nav-item:nth-child(even){text-align:right;padding-right:0;padding-left:20px}.tags ul{list-style:none;display:grid;grid-template-columns:auto auto auto auto auto auto;grid-template-rows:auto auto auto auto}.tags li{white-space:normal;text-overflow:ellipsis}.timeline{position:center;width:650px;margin:-6em auto;padding:1px;list-style-type:none}@media (max-width: 860px){.timeline{width:100%}}.timeline:before{position:absolute;left:50%;top:0;content:' ';display:block;width:6px;height:100%;margin-left:-3px;background:var(--light-text-color);z-index:5}@media (max-width: 375px){.timeline:before{height:150%}}.timeline li{padding:2em 0}@media (max-width: 860px){.timeline li{padding:2em 0}}.timeline li::after{content:"";display:block;height:150%;clear:both;visibility:hidden}.direction-l{position:relative;width:287px;float:left;text-align:right}@media (max-width: 860px){.direction-l{float:none;width:100%;text-align:center}}.direction-l .flag{color:#333;box-shadow:-1px 1px 1px rgba(0,0,0,0.52)}.direction-l .flag:after{content:"";position:absolute;left:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-left-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-l .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-l .time-wrapper{float:left}@media (max-width: 860px){.direction-l .time-wrapper{float:none}}.direction-r{position:relative;width:293px;float:right;text-align:left}@media (max-width: 860px){.direction-r{float:none;width:100%;text-align:center}}.direction-r .flag{color:#333;box-shadow:1px 1px 1px rgba(0,0,0,0.52)}.direction-r .flag:after{content:"";position:absolute;right:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-right-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-r .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-r .flag:before{left:-40px}.direction-r .time-wrapper{float:right}@media (max-width: 860px){.direction-r .time-wrapper{float:none}}.flag-wrapper{position:relative;display:inline-block;text-align:center}@media (max-width: 860px){.flag-wrapper{text-align:center}}.flag-wrapper .flag{position:relative;display:inline;background:#f8f8f8;padding:6px 10px;border-radius:5px;font-weight:600;text-align:left}@media (max-width: 860px){.flag-wrapper .flag{background:#fff;z-index:15}}.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:60%;right:-40px;content:' ';display:block;width:12px;height:12px;margin-top:-10px;background:#fff;border-radius:10px;border:4px solid var(--link-color);z-index:10}@media (max-width: 860px){.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:-30px;left:53%;content:' ';display:block;margin-left:-10px}}.time-wrapper{display:inline;line-height:1em;font-size:0.66666em;color:var(--link-color);vertical-align:middle}@media (max-width: 860px){.time-wrapper{display:block;position:relative;margin:4px 0 0 0;z-index:14}}.time-wrapper .time{display:inline-block;padding:4px 6px;background:#f8f8f8}.desc{margin:1em 0.2em -3.5em 0;font-size:0.9em;line-height:1.5em}.desc a{color:var(--link-color);text-decoration:none}.desc a:hover{text-decoration:underline}@media (max-width: 860px){.desc{position:relative;margin:1em 1em 0 1em;padding:1em;background:var(--code-bg-color);box-shadow:0 0 1px rgba(0,0,0,0.2);z-index:15}}.pfp-bio{text-align:right}.home-pfp{width:200px;margin-top:1rem;margin-bottom:1rem;border-radius:50%;border-color:#333;border-width:3px;border-style:solid;opacity:1}.posts{margin-top:1rem}</style></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-3EP7KLCYVP"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-3EP7KLCYVP'); </script><body><main><section class="post"><div class="flex-row-between"> <a href="https://gueepo.me//">« back</a> <button title="Change theme" id="theme-toggle" onclick="modeSwitcher()"><div></div></button></div><time datetime="2018-12-01T12:00:00+01:00">Dec 1, 2018 - 6 ' read</time><h1 class="title"> What if everyone handles their own persistence?</h1><span class="meta"> <a href="https://gueepo.me//tag/game-development">game-development</a></span><p>Persistence is one of those things that I never want to do and always procrastinate. Persistence is basically having data available at all times on software, to not lose your data when you turn it off, to have it back to you when you turn it on and it is really important for games.</p><p>Hell. I bet you would die if you lost your save state on any game. Those hundreds of hours on your favorite RPG game on Playstation (You have thought of a specific one, haven’t you?).</p><h2 id="the-context"> The Context <a href="#the-context">#</a></h2><p>I was (actually, still am) developing a game called Pizza Clicker. It is an idle incremental game where your goal is to have as much pizza as you can, but the trick is, in order to obtain more pizza, you have to invest pizza. This leads to an endless vicious cycle of spending pizza to earn more pizza.</p><p>There are basically <strong>two ways</strong> of leveling up your pizza production efficiency: <em>incrementers</em> and <em>upgrades</em> - Incrementers gives you more pizza per second or more pizza per click, whereas upgrades make a specific incrementer more efficient.</p><p>As it is a game that consist of accumulating resources, needless to say that persistence is a must on this kind of game. But what needs to be persisted? Basically, <em>how much</em> of each incrementers a player have and <em>what</em> upgrades they have. I started persisting incrementers in a way and halfway through the project I changed how I did it for the upgrades. So basically I’m using different two different logics to persist! Yay!</p><p>And that’s what I’m going to talk about today.</p><h2 id="the-centralized-way"> The Centralized Way <a href="#the-centralized-way">#</a></h2><p>My first approach was having everything centralized on some kind of SaveManager. This led me to having two C# files: <code class="language-plaintext highlighter-rouge">SaveState.cs</code>, which is simply an object with every single aspect I would ever want to persist. It looks like this:</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">SaveState</span> <span class="p">{</span>
	<span class="k">public</span> <span class="kt">string</span> <span class="n">playerName</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">string</span> <span class="n">lastSavedDate</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">double</span> <span class="n">currentPizzas</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">double</span> <span class="n">pizzasOnLifeTime</span><span class="p">;</span>

	<span class="k">public</span> <span class="kt">int</span> <span class="n">cursoreLevel</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">int</span> <span class="n">gennaroLevel</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">int</span> <span class="n">gasOvenLevel</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">int</span> <span class="n">eletricOvenLevel</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">int</span> <span class="n">woodOvenLevel</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">int</span> <span class="n">plasmaOvenLevel</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">int</span> <span class="n">futureOvenLevel</span><span class="p">;</span>	
<span class="p">}</span>
</code></pre></div></div><p>And on another file, called <code class="language-plaintext highlighter-rouge">SaveManager.cs</code>, for every variable I have another variable with a string, a persist string, and it is something like this:</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="c1">// Pizzeria</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">playerName</span> <span class="p">=</span> <span class="s">"v1_PLAYER_NAME"</span><span class="p">;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">lastDate</span> <span class="p">=</span> <span class="s">"v1_LAST_DATE"</span><span class="p">;</span>

<span class="c1">// Pizzas</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">currentPizzas</span> <span class="p">=</span> <span class="s">"v1_CURRENT_PIZZAS"</span><span class="p">;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">lifetimePizzas</span> <span class="p">=</span> <span class="s">"v1_LIFETIMEPIZZAS"</span><span class="p">;</span>
<span class="p">...</span>
</code></pre></div></div><p>And finally, for me to save I can do something like this:</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="c1">// Incrementers</span>
<span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="n">cursoreLevel</span><span class="p">,</span> <span class="n">toPersist</span><span class="p">.</span><span class="n">cursoreLevel</span><span class="p">);</span>
<span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="n">gennaroLevel</span><span class="p">,</span> <span class="n">toPersist</span><span class="p">.</span><span class="n">gennaroLevel</span><span class="p">);</span>
<span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="n">gasOvenLevel</span><span class="p">,</span> <span class="n">toPersist</span><span class="p">.</span><span class="n">gasOvenLevel</span><span class="p">);</span>
<span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="n">eletricOvenLevel</span><span class="p">,</span> <span class="n">toPersist</span><span class="p">.</span><span class="n">eletricOvenLevel</span><span class="p">);</span>
<span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="n">woodOvenLevel</span><span class="p">,</span> <span class="n">toPersist</span><span class="p">.</span><span class="n">woodOvenLevel</span><span class="p">);</span>
<span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="n">plasmaOvenLevel</span><span class="p">,</span> <span class="n">toPersist</span><span class="p">.</span><span class="n">plasmaOvenLevel</span><span class="p">);</span>
<span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="n">futureOvenLevel</span><span class="p">,</span> <span class="n">toPersist</span><span class="p">.</span><span class="n">futureOvenLevel</span><span class="p">);</span>
<span class="p">...</span>
</code></pre></div></div><p>So if I want to restore, I can do it like this:</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="n">saveState</span><span class="p">.</span><span class="n">cursoreLevel</span> <span class="p">=</span> <span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="n">cursoreLevel</span><span class="p">);</span>
<span class="n">saveState</span><span class="p">.</span><span class="n">gennaroLevel</span> <span class="p">=</span> <span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="n">gennaroLevel</span><span class="p">);</span>
<span class="n">saveState</span><span class="p">.</span><span class="n">gasOvenLevel</span> <span class="p">=</span> <span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="n">gasOvenLevel</span><span class="p">);</span>
<span class="n">saveState</span><span class="p">.</span><span class="n">eletricOvenLevel</span> <span class="p">=</span> <span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="n">eletricOvenLevel</span><span class="p">);</span>
<span class="n">saveState</span><span class="p">.</span><span class="n">woodOvenLevel</span> <span class="p">=</span> <span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="n">woodOvenLevel</span><span class="p">);</span>
<span class="n">saveState</span><span class="p">.</span><span class="n">plasmaOvenLevel</span> <span class="p">=</span> <span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="n">plasmaOvenLevel</span><span class="p">);</span>
<span class="n">saveState</span><span class="p">.</span><span class="n">futureOvenLevel</span> <span class="p">=</span> <span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="n">futureOvenLevel</span><span class="p">);</span>
<span class="p">...</span>
</code></pre></div></div><h3 id="what-if-i-want-to-add-an-incrementer"> What if I want to add an Incrementer? <a href="#what-if-i-want-to-add-an-incrementer">#</a></h3><p>If I ever want to add an incrementer (which <strong>probably</strong> will be the case in a few weeks or months), I just have to follow the following list of tasks:</p><ol><li>Plan the incrementer, how much <em>ppc</em> or <em>pps</em> it will give;</li><li>Add it to the User Interface with the <code class="language-plaintext highlighter-rouge">Incrementer.cs</code> script, all configured;</li><li>Go to the <code class="language-plaintext highlighter-rouge">SaveState.cs</code> and add the new incrementer there;</li><li>Go to the <code class="language-plaintext highlighter-rouge">SaveManager.cs</code> and create the string variable for the new incrementer, after that I have to add the new incrementer on the <code class="language-plaintext highlighter-rouge">InitFirstTime()</code> function, and then I have to also add it on the <code class="language-plaintext highlighter-rouge">GetSaveState()</code> and on <code class="language-plaintext highlighter-rouge">PersistState(SaveState state)</code>;</li></ol><p>Needles to say steps 3 and 4 are <strong>very</strong> prone to error. If I mistaken something along the way the new incrementer can break, players will be upset and it will be bad. Also, if I want to add an incrementer when the game is already on production, I have to write code to migrate the save state from one way to another (i.e. recognize there is no “NewIncrementer” saved and that is because of the new version, so I have to initialize it on the save file with a 0).</p><p>In other words, to keep working this way, I would also have to work with a <code class="language-plaintext highlighter-rouge">MigrateSave()</code> function, which at the moment looks like this:</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">void</span> <span class="nf">MigrateSave</span><span class="p">()</span> <span class="p">{</span>
	<span class="c1">// check what version is saved and what is the current version and migrate it.</span>
	<span class="c1">// TO DO</span>
	<span class="k">return</span><span class="p">;</span> 
<span class="p">}</span>
</code></pre></div></div><p>I want to keep it like this.</p><h2 id="what-if-everyone-handle-their-own-stuff"> What If Everyone Handle their own Stuff? <a href="#what-if-everyone-handle-their-own-stuff">#</a></h2><p>I needed to add another feature on Pizza Clicker, the <em>Upgrades</em>, which are similar to how the Incrementers work, but instead of adding to how much pizza you produce, they just improve an Incrementer’s efficiency.</p><p>When I started, I was like: “Do I have to do all of that again? Create a variable for every upgrade and persist every one of them and migrate and…” - At some point I thought of doing the persistence on each individual Upgrade.</p><p>When I buy an upgrade, it immediately saves its value as 1. When Initializing the game it checks its own persistenceString and check whether or not it was bought. Looks better, right?</p><p>To save, I have to create just one more variable on <code class="language-plaintext highlighter-rouge">Upgrade.cs</code>, a string which will be used to persist.</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">Header</span><span class="p">(</span><span class="s">"Persistance Settings"</span><span class="p">)]</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">persistString</span><span class="p">;</span>
</code></pre></div></div><p>And then when initializing the game I can just check like this:</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="n">persistString</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">persistString</span> <span class="p">!=</span> <span class="s">""</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="n">persistString</span><span class="p">)</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="nf">Apply</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>What is <code class="language-plaintext highlighter-rouge">Apply()</code>? You may ask.</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">Apply</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(!</span><span class="n">m_wasBought</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">incrementerToImprove</span><span class="p">.</span><span class="n">pizzaPerClick</span> <span class="p">*=</span> <span class="p">(</span><span class="m">1</span> <span class="p">+</span> <span class="n">pizzaPerClickImprovement</span><span class="p">);</span>
		<span class="n">incrementerToImprove</span><span class="p">.</span><span class="n">pizzaPerSecond</span> <span class="p">*=</span> <span class="p">(</span><span class="m">1</span> <span class="p">+</span> <span class="n">pizzaPerSecondImprovement</span><span class="p">);</span>
		<span class="n">PlayerPrefs</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="n">persistString</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
		<span class="n">m_wasBought</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
		<span class="n">Pizzeria</span><span class="p">.</span><span class="n">instance</span><span class="p">.</span><span class="nf">RecalculatePPCPPS</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>To summarize it quickly, the <code class="language-plaintext highlighter-rouge">Apply()</code> function is called when the incrementer is bought or when the game is initialized and the persistString exists on the save file.</p><h3 id="what-if-i-want-to-add-an-upgrade"> What if I want to add an Upgrade? <a href="#what-if-i-want-to-add-an-upgrade">#</a></h3><p>I <strong>will</strong> want to add more upgrades as time goes by. To do that I can simply follow this list of tasks:</p><ol><li>Plan the upgrade, which incrementer will it affect and how much;</li><li>Add it to the User Interface with the <code class="language-plaintext highlighter-rouge">Upgrade.cs</code> script, all configured;</li><li>Set the <code class="language-plaintext highlighter-rouge">persistString</code> attribute to something unique.</li></ol><p>There is just one point where I can make a mistake here and it is on <strong>Step 3</strong>, I can simply forget to set the string, which is easily caught on testing. Having only one possible error is way better than 3 or 4.</p><p>Aaand this is the story of the persistence of <a href="http://fourthdimension.studio/pizzaclicker/">Pizza Clicker (download it here!)</a> - I know it’s nothing innovative or whatever, but it was something that happened to me and I wanted to write my thoughts on it.</p><p>Hope it helps someone somewhere!</p><p>You can get in contact with me whenever you want if you have any questions, all my social media and email are on my <a href="http://gueepo.me">personal website</a></p></section><!--<section><nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/2018/07/24/ai-analysis-pokemon-puzzle-challenge"><div class="nav-arrow">Previous</div><span class="post-title">AI Analysis of Pokemon Puzzle Challenge</span> </a> <a class="post-nav-item post-nav-next" href="/2019/04/07/screenshake-unity-2"><div class="nav-arrow">Next</div><span class="post-title">Even better Screenshake in Unity!</span> </a></nav></section>--><hr></main><script> function setTheme(theme) { if (theme === "dark") { document.documentElement.setAttribute('data-theme', 'dark'); window.localStorage.setItem('theme', 'dark'); document.getElementById("theme-toggle").classList.add('sun'); document.getElementById("theme-toggle").classList.remove('moon'); } else { document.documentElement.setAttribute('data-theme', 'light'); window.localStorage.setItem('theme', 'light'); document.getElementById("theme-toggle").classList.add('moon'); document.getElementById("theme-toggle").classList.remove('sun'); } } let theme = localStorage.getItem('theme'); theme = theme || (window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light' : 'light'); setTheme(theme); function modeSwitcher() { let currentMode = document.documentElement.getAttribute('data-theme'); if (currentMode === "dark") { setTheme('light'); } else { setTheme('dark'); } } </script></body><footer class="social-footer"><div class="social-footer-icons"><p>based on the template <a href="https://github.com/DavideBrie/Gesko" title="Browse the code" target="_blank" rel="noopener noreferrer">gesko</a></p></div></footer></html>
