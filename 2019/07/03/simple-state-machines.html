<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="https://gueepo.me/assets/css/syntax.css"><link rel="preconnect" href="https://cdnjs.cloudflare.com"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><title> Coding a simple State Machine - gueepo</title><link rel="shortcut icon" href="https://gueepo.me/favicon.png"><link rel="alternate" type="application/atom+xml" title="gueepo" href="https://gueepo.me/atom.xml"><link rel="alternate" type="application/json" title="gueepo" href="https://gueepo.me/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="https://gueepo.me/sitemap.xml" /><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,300;1,400;1,500;1,600;1,700;1,900&display=swap" rel="stylesheet"><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}html{font-size:15px}#theme-toggle{opacity:0.65;position:relative;border-radius:5px;height:25px;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;transition:opacity 0.3s ease 0s;border:none;outline:none;background:none;cursor:pointer;padding:0px;appearance:none;transform:scale(0.8)}html,html[data-theme="light"]{--text-font: Play;--source-code-font: Source Code Pro;--very-light-text-color: rgb(222, 222, 222);--light-text-color: rgb(89, 183, 255);--medium-text-color: #555;--main-text-color: #333;--highlight-text-color: #6cb4a0;--dark-text-color: #393e46;--link-color: rgb(50, 87, 209);--code-bg-color: rgb(245, 245, 245);background-color:#fff}html #theme-toggle div,html[data-theme="light"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:none;background-color:var(--theme-ui-colors-transparent, transparent);transform:scale(1);transition:all 0.45s ease 0s;overflow:hidden;box-shadow:inset 8px -8px 0px 0px var(--theme-ui-colors-toggleIcon, #2d3748)}html #theme-toggle div::before,html[data-theme="light"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:none;border-radius:50%;transform:translate(0px, 0px);opacity:1;transition:transform 0.45s ease 0s}html #theme-toggle div::after,html[data-theme="light"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),0 23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),-23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748);transform:scale(0);transition:all 0.35s ease 0s}html[data-theme="dark"]{--text-font: Play;--source-code-font: Source Code Pro;--very-light-text-color: #EEE;--light-text-color: #c4bbf0;--medium-text-color: #52057b;--main-text-color: #EAEAEA;--highlight-text-color: #6cb4a0;--dark-text-color: rgb(36, 38, 42);--link-color: rgb(255, 89, 125);--code-bg-color: rgb(36, 38, 42);background-color:#131418}html[data-theme="dark"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:4px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);background-color:var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(0.55);transition:all 0.45s ease 0s;overflow:visible;box-shadow:none}html[data-theme="dark"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:2px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);border-radius:50%;transform:translate(14px, -14px);opacity:0;transition:transform 0.45s ease 0s}html[data-theme="dark"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),0 23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(1);transition:all 0.35s ease 0s}body{font-family:var(--text-font),monospace;text-rendering:optimizeLegibility;line-height:1.75;color:var(--main-text-color)}a{color:var(--link-color);text-decoration:none}.post p{margin:1rem 0}.meta{margin:1.4rem 0}code,pre{background:var(--code-bg-color);margin:0 -27px;border-width:1px}code{font-family:var(--source-code-font),monospace;margin:unset;padding:0.1rem;color:var(--highlight-text-color)}pre code{background-color:unset;color:unset}pre{border-width:3px;padding:0.8rem;white-space:pre-wrap;border-style:none none none solid;border-color:var(--light-text-color)}img{max-width:100%}hr{background:var(--light-text-color);height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:0.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem 0}section{margin-top:8rem}blockquote{font-style:italic;border-left:5px solid var(--dark-text-color);padding-left:1rem}h1{color:var(--main-text-color);text-transform:uppercase;font-size:2rem;font-weight:bold;margin-bottom:1.5rem}h2,h3,h4,h5{font-weight:bold;margin-bottom:1.5rem;font-size:2rem}h2{font-size:1.8rem}h3{font-size:1.6rem}h4{font-size:1.4rem}h5{font-size:1.2rem}h6{font-size:1rem}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts>h3{font-weight:500}.post ul{margin:0px;margin:0px 0px 10px 10px}.post ol{margin:0px;margin:0px 0px 10px 15px}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:0.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}time{color:var(--main-text-color)}.post>h1.title{font-size:x-large;margin-top:0;margin-bottom:0}.post>time{margin-bottom:0;margin-top:3rem}.highlight{margin:0px}main{display:flex;max-width:47rem;margin:-5rem auto 0;padding-top:2.4rem;padding-bottom:0.0rem;padding-left:2rem;padding-right:2rem;flex-direction:column}.flex-row-between{display:flex;flex-direction:row;justify-content:space-between}.social-footer{padding:1rem;display:flex;justify-content:center;position:initial}.social-footer .social-footer-icons .fa{font-size:1.3rem;color:#a9a9a9}.social-footer .social-footer-icons .fa:hover{color:dimgray;transition:color 0.3s ease-in}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}main{padding:0 2rem}}section{flex-grow:999;display:flex;flex-direction:column}figcaption{font-size:smaller}.bio{margin-bottom:1rem}::selection{background-color:#fffba0;color:#333}.search-article{position:relative}.search-article label[for="search-input"]{position:relative;top:-10px;left:11px}.search-article input[type="search"]{top:-1rem;left:0;border:0;width:100%;height:30px;outline:none;position:absolute;border-radius:5px;padding:10px 10px 10px 35px;color:var(--main-text-color);-webkit-appearance:none;background-color:rgba(128,128,128,0.1);border:1px solid rgba(128,128,128,0.1)}.search-article input[type="search"]::-webkit-input-placeholder{color:#808080}.search-article input[type="search"]::-webkit-search-decoration,.search-article input[type="search"]::-webkit-search-results-decoration{display:none}#search-results{text-align:center}#search-results li{text-align:center}#search-results li::before{content:"›";display:inline-block;margin-left:-1.3em;width:1.3em;color:var(--main-text-color)}.post-nav{display:flex;position:relative;margin-top:0;border-top:2px solid var(--light-text-color);line-height:1.4}.post-nav .post-nav-item{border-bottom:0;padding-bottom:10px;width:50%;padding-top:10px;text-decoration:none;box-sizing:border-box}.post-nav .post-nav-item .post-title{color:var(--main-text-color)}.post-nav .post-nav-item:hover .post-title,.post-nav .post-nav-item:focus .post-title{color:var(--link-color);opacity:0.9}.post-nav .post-nav-item .nav-arrow{font-size:17px;color:var(--main-text-color);margin-bottom:3px;font-weight:bold}.post-nav .post-nav-item:nth-child(odd){padding-left:0;padding-right:20px}.post-nav .post-nav-item:nth-child(even){text-align:right;padding-right:0;padding-left:20px}.tags ul{list-style:none;display:grid;grid-template-columns:auto auto auto auto auto auto;grid-template-rows:auto auto auto auto}.tags li{white-space:normal;text-overflow:ellipsis}.timeline{position:center;width:650px;margin:-6em auto;padding:1px;list-style-type:none}@media (max-width: 860px){.timeline{width:100%}}.timeline:before{position:absolute;left:50%;top:0;content:' ';display:block;width:6px;height:100%;margin-left:-3px;background:var(--light-text-color);z-index:5}@media (max-width: 375px){.timeline:before{height:150%}}.timeline li{padding:2em 0}@media (max-width: 860px){.timeline li{padding:2em 0}}.timeline li::after{content:"";display:block;height:150%;clear:both;visibility:hidden}.direction-l{position:relative;width:287px;float:left;text-align:right}@media (max-width: 860px){.direction-l{float:none;width:100%;text-align:center}}.direction-l .flag{color:#333;box-shadow:-1px 1px 1px rgba(0,0,0,0.52)}.direction-l .flag:after{content:"";position:absolute;left:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-left-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-l .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-l .time-wrapper{float:left}@media (max-width: 860px){.direction-l .time-wrapper{float:none}}.direction-r{position:relative;width:293px;float:right;text-align:left}@media (max-width: 860px){.direction-r{float:none;width:100%;text-align:center}}.direction-r .flag{color:#333;box-shadow:1px 1px 1px rgba(0,0,0,0.52)}.direction-r .flag:after{content:"";position:absolute;right:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-right-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-r .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-r .flag:before{left:-40px}.direction-r .time-wrapper{float:right}@media (max-width: 860px){.direction-r .time-wrapper{float:none}}.flag-wrapper{position:relative;display:inline-block;text-align:center}@media (max-width: 860px){.flag-wrapper{text-align:center}}.flag-wrapper .flag{position:relative;display:inline;background:#f8f8f8;padding:6px 10px;border-radius:5px;font-weight:600;text-align:left}@media (max-width: 860px){.flag-wrapper .flag{background:#fff;z-index:15}}.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:60%;right:-40px;content:' ';display:block;width:12px;height:12px;margin-top:-10px;background:#fff;border-radius:10px;border:4px solid var(--link-color);z-index:10}@media (max-width: 860px){.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:-30px;left:53%;content:' ';display:block;margin-left:-10px}}.time-wrapper{display:inline;line-height:1em;font-size:0.66666em;color:var(--link-color);vertical-align:middle}@media (max-width: 860px){.time-wrapper{display:block;position:relative;margin:4px 0 0 0;z-index:14}}.time-wrapper .time{display:inline-block;padding:4px 6px;background:#f8f8f8}.desc{margin:1em 0.2em -3.5em 0;font-size:0.9em;line-height:1.5em}.desc a{color:var(--link-color);text-decoration:none}.desc a:hover{text-decoration:underline}@media (max-width: 860px){.desc{position:relative;margin:1em 1em 0 1em;padding:1em;background:var(--code-bg-color);box-shadow:0 0 1px rgba(0,0,0,0.2);z-index:15}}.pfp-bio{text-align:center}.home-pfp{width:500px;margin-top:1rem;margin-bottom:1rem;border-radius:0%;border-color:#333;border-width:3px;border-style:solid;opacity:1}.posts{margin-top:1rem}</style></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-3EP7KLCYVP"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-3EP7KLCYVP'); </script><body><main><section class="post"><div class="flex-row-between"> <a href="https://gueepo.me/">« back</a> <button title="Change theme" id="theme-toggle" onclick="modeSwitcher()"><div></div></button></div><time datetime="2019-07-03T13:00:00+02:00">Jul 3, 2019 - 8 ' read</time><h1 class="title"> Coding a simple State Machine</h1><span class="meta"> </span><p>This blog post is my simple take on State Machines and how I usually use them in my projects, specially in games made in Unity. The image on the header is from another article on the same subject that I consider to be more complete and better explained, I highly recommend you to read the article: <a href="https://gameprogrammingpatterns.com/state.html">State Pattern</a> - If you still want to read my take and how I approach it, keep reading!</p><p>Have you ever heard of State Machines? It is one of those weird cryptical words that appears in Computer Science, Computer Programming, Game Programming and a lot places really! When you try to research it you probably will find out about plenty of mathematical concepts, but none of those conjunct notation or math theory and hypothesis stuff will answer your basic question: “How do I create a state machine in my code?”</p><p>In the long run, State Machines are really benefical for your code, have you ever stumbled upon a problem where you got yourself creating multiple booleans to keep track of what was happening? And you had to debug all those values and code that shouldn’t be executed is executing and the biggest problem is that you can’t guarantee stability in your code, you just know that pieces of code shouldn’t be running and even though the result might work, you feel deep down that it is something built on a weak foundation.</p><p>This is a post mainly about Game Programming, because hey, that’s my job. But State Machines are theoretical models, so maybe you can find something useful here if you are a mathematician, computer scientist, a programmer which is not a game programmer or just interested in the topic. If you have a science background, you might get mad of my oversimplification later on though, but that’s how we do things. <em>shrug</em></p><h2 id="but-what-is-a-state-machine"> But what is a State Machine? <a href="#but-what-is-a-state-machine">#</a></h2><h3 id="the-mathematical-model"> The Mathematical Model <a href="#the-mathematical-model">#</a></h3><p>According to Wikipedia, a State Machine, also known as Finite-State Machine (FSM) or Finite Automaton is “a mathematical model of computation, an abstract machine that can be in exactly one of a finite number of states at any given time, it changes from one state to another in response to some external inputs, this is called a state transition”.</p><p>Yikes!</p><p>A Finite-State Machine is mathematically defined as a list of states, an initial state and a set of rules or conditions for EVERY transition (keep this in mind because it will be important).</p><p>That’s some mathemtical lingo right there, Finite-State Machines are, putting it more straightforward, a mathematical model designed to compute things, a state machine is also known as an automata, and you may have heard of a famous automata called the <em>Turing Machine</em>. The Turing Machine is another model of computation that claims to be able to solve any problem that can be described as a recursively enumerable language. That’s cool and stuff, in practice a Turing Machine is a Finite-State machine with infinite memory and the ability to go back and forth on the memory. It is also known as “your computer” (not really, but close enough).</p><h3 id="the-simplified-version"> The Simplified Version <a href="#the-simplified-version">#</a></h3><p>Although Finite-State Machines and Automatas are something complex enough for you to have a whole semester dedicated to them, its essence, and what really matters to incorporating one in our code, can be simplified into a couple paragraphs.</p><p>A Finite-State Machine is a list of states, an initial state and the rules for transitions between states. That’s pretty much it.</p><p>Its purpose is to isolate pieces of code from one another, for example, in a simple platformer game, you want to have separate code for when the player is grounded and when the player is on air, these are your states: “Player Grounded” and “Player on Air”, the initial state is Grounded and the rules are:</p><ul><li>Grounded -&gt; Jumping: If the player pressed to jump.</li><li>Jumping -&gt; Grounded: If the player touches the ground.</li></ul><p>It is easy to see how the state machine helps us in this context too, if you don’t have it, you have to check if the player is grounded to jump, otherwise the player could keep jumping on air. Although this is a very simple sitation and you could solve that with creating a simple <code class="language-plaintext highlighter-rouge">isGrounded</code> variable, you have to recognize that (1) creating this variable <strong>IS</strong> a form of creating a very simple state machine and (2) this is a VERY simple problem, try adding wall slide on your game, wall jump, dialogue breaks, cutscenes and watch your player controller script fall apart with bugs and bad performance if you haven’t planned well. Believe me, I’ve been there way too many times.</p><p>State Machines are good for isolating code, but not only that, they can scale, they make it easier to add new features on your script without breaking everything else, which really is what matters on long term projects.</p><h2 id="how-to-code-one"> How to Code One? <a href="#how-to-code-one">#</a></h2><p>Let’s recapitulate what we actually need for having a state machine.</p><ol><li>We have to define a list of states</li><li>We have to define an initial state</li><li>We have to define transitions between states.</li></ol><h3 id="defining-the-states"> Defining the States <a href="#defining-the-states">#</a></h3><p>I, personally, like to do that using <code class="language-plaintext highlighter-rouge">enums</code> and I honestly believe this is the best way to go, you can use <code class="language-plaintext highlighter-rouge">enum</code> for your states and process then with a current state variable and a switch-case structure. For this example I’m going to pretend I am programming a 2D platformer with wall jump and that the jump from the wall is different from the regular jump, so these would be my states:</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">enum</span> <span class="n">EPlayerState</span> <span class="p">{</span>
    <span class="n">Grounded</span><span class="p">,</span>
    <span class="n">Jumping</span><span class="p">,</span>
    <span class="n">OnWall</span><span class="p">,</span>
    <span class="n">JumpingFromWall</span>
<span class="p">}</span>
</code></pre></div></div><p>We have our states, but we also need to keep track of our current state, this can be done with a simple variable.</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="n">EPlayerState</span> <span class="n">m_currentPlayerState</span><span class="p">;</span>
</code></pre></div></div><h3 id="defining-an-initial-state"> Defining an Initial State <a href="#defining-an-initial-state">#</a></h3><p>This one is the easiest, the player will start grounded, so it should start on the grounded state, you can do that when declaring the variable or just setting it on the Start function.</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">void</span> <span class="nf">Start</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Grounded</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="defining-the-transtions"> Defining the transtions <a href="#defining-the-transtions">#</a></h3><p>This is where it gets tricky, you need to handle every state individually and make sure that each state has a condition that will lead to another state, avoiding termination problems. To handle the states, I usually have a switch-case structure on my <code class="language-plaintext highlighter-rouge">Update()</code> method that would look like this:</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">switch</span><span class="p">(</span><span class="n">m_currentPlayerState</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Grounded</span><span class="p">:</span>
        <span class="nf">GroundedState</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Jumping</span><span class="p">:</span>
        <span class="nf">JumpingState</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">OnWall</span><span class="p">:</span>
        <span class="nf">OnWallState</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">JumpingFromWall</span><span class="p">:</span>
        <span class="nf">JumpingFromWallState</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>Every state now has their own specific function, nothing is stopping you from putting everything just there on the switch-case, it is just a matter of organization. All you have to do now is create each function to handle the specifics of each state and transition to other states!</p><p>Grounded State:</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">GroundedState</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// grounded specifics</span>
    <span class="k">if</span><span class="p">(</span><span class="n">playerJump</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// jump...</span>

        <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Jumping</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>Jumping State:</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">JumpingState</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// jumping specifics...</span>

    <span class="k">if</span><span class="p">(</span><span class="n">isGrounded</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Grounded</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">collidingWithWalls</span> <span class="p">&amp;&amp;</span> <span class="n">playerJump</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">JumpingFromWall</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">collidingWithWalls</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">OnWall</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>On Wall State:</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">OnWallState</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// on wall specifics...</span>

    <span class="k">if</span><span class="p">(</span><span class="n">playerJump</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">JumpingFromWall</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">isGrounded</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Grounded</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>Jumping From Wall State:</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">JumpingFromWallState</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// jumping from wall specifics... </span>

    <span class="k">if</span><span class="p">(</span><span class="n">isGrounded</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Grounded</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="sample-code"> Sample Code <a href="#sample-code">#</a></h2><p>This is the entirety of a simple state machine code I’ve written as a base for this post:</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">SampleStateMachine</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>

    <span class="c1">// using enum to name our states</span>
    <span class="k">public</span> <span class="k">enum</span> <span class="n">EPlayerState</span> <span class="p">{</span>
        <span class="n">Grounded</span><span class="p">,</span>
        <span class="n">Jumping</span><span class="p">,</span>
        <span class="n">OnWall</span><span class="p">,</span>
        <span class="n">JumpingFromWall</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="n">EPlayerState</span> <span class="n">m_currentPlayerState</span><span class="p">;</span>

    <span class="c1">// random variables to keep the code readable lol</span>
    <span class="k">private</span> <span class="kt">bool</span> <span class="n">playerJump</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">bool</span> <span class="n">isGrounded</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">bool</span> <span class="n">collidingWithWalls</span><span class="p">;</span>

    <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Grounded</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span> <span class="p">{</span>

        <span class="c1">// common code for all states goes here...</span>

        <span class="c1">// handling the current state</span>
        <span class="k">switch</span><span class="p">(</span><span class="n">m_currentPlayerState</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Grounded</span><span class="p">:</span>
                <span class="nf">GroundedState</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Jumping</span><span class="p">:</span>
                <span class="nf">JumpingState</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">OnWall</span><span class="p">:</span>
                <span class="nf">OnWallState</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">JumpingFromWall</span><span class="p">:</span>
                <span class="nf">JumpingFromWallState</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// mess with x velocity</span>
        <span class="c1">// do stuff with y velocity</span>
        <span class="c1">// player.Move();</span>
    <span class="p">}</span>

    <span class="c1">// Functions for each state</span>
    <span class="c1">// each state handles its own specific things and transitioning to other states</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">GroundedState</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// grounded specifics...</span>

        <span class="k">if</span><span class="p">(</span><span class="n">playerJump</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Jumping</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">JumpingState</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// jumping specifics...</span>

        <span class="k">if</span><span class="p">(</span><span class="n">isGrounded</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Grounded</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">collidingWithWalls</span> <span class="p">&amp;&amp;</span> <span class="n">playerJump</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">JumpingFromWall</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">collidingWithWalls</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">OnWall</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnWallState</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// on wall specifics...</span>

        <span class="k">if</span><span class="p">(</span><span class="n">playerJump</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">JumpingFromWall</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">isGrounded</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Grounded</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">JumpingFromWallState</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// jumping from wall specifics... </span>

        <span class="k">if</span><span class="p">(</span><span class="n">isGrounded</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">m_currentPlayerState</span> <span class="p">=</span> <span class="n">EPlayerState</span><span class="p">.</span><span class="n">Grounded</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>So that was me trying to explain Finite State Machines! I’ve tried to give some mathematical insight, some simplified explanation and go on about how I pesonally use them in my daily stuff as a game programmer</p><p>If you are feeling venturous enough, you can reach me on <a href="http://twitter.com/guilhermepo2">Twitter</a> or check my own game studio, <a href="https://fourthdimension.studio">Fourth Dimension</a>.</p></section><!--<section><nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/2019/04/07/screenshake-unity-2"><div class="nav-arrow">Previous</div><span class="post-title">Even better Screenshake in Unity!</span> </a> <a class="post-nav-item post-nav-next" href="/2020/02/14/player-blocking-using-the-dot-product"><div class="nav-arrow">Next</div><span class="post-title">Player Blocking using the Dot Product</span> </a></nav></section>--><hr></main><script> function setTheme(theme) { if (theme === "dark") { document.documentElement.setAttribute('data-theme', 'dark'); window.localStorage.setItem('theme', 'dark'); document.getElementById("theme-toggle").classList.add('sun'); document.getElementById("theme-toggle").classList.remove('moon'); } else { document.documentElement.setAttribute('data-theme', 'light'); window.localStorage.setItem('theme', 'light'); document.getElementById("theme-toggle").classList.add('moon'); document.getElementById("theme-toggle").classList.remove('sun'); } } let theme = localStorage.getItem('theme'); theme = theme || (window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light' : 'light'); setTheme(theme); function modeSwitcher() { let currentMode = document.documentElement.getAttribute('data-theme'); if (currentMode === "dark") { setTheme('light'); } else { setTheme('dark'); } } </script></body><footer class="social-footer"><div class="social-footer-icons"><p>based on the template <a href="https://github.com/DavideBrie/Gesko" title="Browse the code" target="_blank" rel="noopener noreferrer">gesko</a></p></div></footer></html>
